# Gavin Lyons 05-2023
# Makefile to build example program for MAX7219_7SEG_RPI library.
# URL: https://github.com/gavinlyonsrepo/MAX7219_7SEG_RPI

# ************************************************

#Note : CFLAGS : -std=c++2a needed by Clock Demo ONLY

# **************************************
# Options
# 1. make (compile's example file)
# 2. make clean (deletes .o files generated by step 1 from build directory)
# 3. make run (starts exe file) (note :: wraps sudo)
# **************************************

# **** User SRC directory Option Section *********
# pick on example "#SRC" dir and ONE ONLY.
# Comment out the others. 
SRC=src/HELLOWORLD_HWSPI
#SRC=src/TESTS
#SRC=src/TESTS_HWSPI
#SRC=src/BCDMODE
#SRC=src/CLOCK_DEMO
#SRC=src/CASCADE_DEMO
#************************************************

CC=g++
LDFLAGS= -lbcm2835 -lMAX7219_7SEG_RPI 
CFLAGS= -std=c++2a  -Iinclude/ -c -Wall 
MD=mkdir
OBJ=obj
SRCS = $(wildcard $(SRC)/*.cpp)
OBJS = $(patsubst $(SRC)/%.cpp,  $(OBJ)/%.o, $(SRCS))
BIN=./bin
TARGET=$(BIN)/test

all: clean pre-build $(TARGET) 

run:
	sudo $(TARGET) 

pre-build:
	@echo '****************'
	@echo 'START!'
	$(MD) -vp $(BIN)
	$(MD) -vp $(OBJ)


$(TARGET): $(OBJS) $(OBJ)
	@echo 'MAKE EXE FILE'
	$(CC)  $(OBJS) -o $@ $(LDFLAGS)
	@echo 'DONE!'
	@echo '****************'

$(OBJ)/%.o :  $(SRC)/%.cpp   $(OBJ) 
	@echo 'MAKE OBJECT FILE'
	$(CC) $(CFLAGS) $< -o  $@ 

clean:
	@echo '****************'
	@echo 'CLEANUP!'
	rm -vf  $(OBJS) $(TARGET)
	@echo 'DONE!'
	@echo '****************'
